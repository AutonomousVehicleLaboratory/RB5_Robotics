
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="RB5 ROBOTICS TUTORIALS">
    <title>Archives: 2022/2 - RB5 ROBOTICS TUTORIALS</title>
    <meta name="author" content="RB5 ROBOTICS TUTORIALS">
    
    
    
    <script type="application/ld+json">{}</script>
    <meta name="description" content="Some description for subtitle">
<meta property="og:type" content="blog">
<meta property="og:title" content="RB5 ROBOTICS TUTORIALS">
<meta property="og:url" content="https://autonomousvehiclelaboratory.github.io/RB5_Robotics_Tutorials/archives/2022/02/index.html">
<meta property="og:site_name" content="RB5 ROBOTICS TUTORIALS">
<meta property="og:description" content="Some description for subtitle">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="RB5 ROBOTICS TUTORIALS">
<meta name="twitter:card" content="summary">
    
    
        
    
    
        <meta property="og:image" content="https://autonomousvehiclelaboratory.github.io/RB5_Robotics_Tutorials/assets/images/avl-letters.png"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/RB5_Robotics_Tutorials/assets/css/style-64qguiewfoxvxmp0xtsq6t9zwhtgymxalbr3hofnf6gpcss5mvrocwased14.min.css">

    <!--STYLES END-->
    

    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="2">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/RB5_Robotics_Tutorials/"
            aria-label=""
        >
            RB5 ROBOTICS TUTORIALS
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /RB5_Robotics_Tutorials/#about"
            >
        
        
            <img class="header-picture" src="/RB5_Robotics_Tutorials/assets/images/avl-letters.png" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="2">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/RB5_Robotics_Tutorials/#about"
                    aria-label="Read more about the author"
                >
                    <img class="sidebar-profile-picture" src="/RB5_Robotics_Tutorials/assets/images/avl-letters.png" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">RB5 ROBOTICS TUTORIALS</h4>
                
                    <h5 class="sidebar-profile-bio"><p>A set of Robotics Tutorials developed for the RB5 Robotics Development Platform from Qualcomm. Authors are from the Contextual Robotics Institute at UC San Diego.</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/RB5_Robotics_Tutorials/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/RB5_Robotics_Tutorials/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/RB5_Robotics_Tutorials/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/AutonomousVehicleLaboratory"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="mailto:avl@eng.ucsd.edu"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Mail"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="2"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/RB5_Robotics_Tutorials/2022/02/15/2%20Accessing%20Devices/accessing-camera-on-rb5/"
                            aria-label=": (1) Accessing the peripherals on Qualcomm Robotics RB5"
                        >
                            (1) Accessing the peripherals on Qualcomm Robotics RB5
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2022-02-15T17:12:21-08:00">
	
		    Feb 15, 2022
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/RB5_Robotics_Tutorials/categories/2-Accessing-Devices/">2 Accessing Devices</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>A key sensor for many robotics applications is camera. It enables cool applications such as object detection, semantic segmentation and visual SLAM. There are two cameras on Qualcomm Robotics RB5.</p>
<p>This tutorial will tell you a few ways to access these cameras. Before we start, note that these cameras cannot be read from OpenCV directly but a tool called GStreamer can bridge the gap.</p>
<h2 id="OpenCV-access-through-GStreamer-and-tcp"><a href="#OpenCV-access-through-GStreamer-and-tcp" class="headerlink" title="OpenCV access through GStreamer and tcp"></a>OpenCV access through GStreamer and tcp</h2><p>The easiest way to access camera is through a tcp port created by GStreamer. Then you can use OpenCV to read data from the tcp port.</p>
<p>On Qualcomm Robotics RB5, run the following command:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gst-launch-1.0 -e qtiqmmfsrc name=qmmf ! video/x-h264,format=NV12, width=1280, height=720,framerate=30/1 ! h264parse config-interval=1 ! mpegtsmux name=muxer ! queue ! tcpserversink port=8900 host=192.168.1.120</span><br></pre></td></tr></table></figure>

<p>Note that you will need to change the host ip to your Qualcomm Robotics RB5â€™s IP address. This can be done by running the following command.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install net-tools # if you don&#x27;t have ifconfig</span><br><span class="line">ifconfig</span><br></pre></td></tr></table></figure>

<p>The ip address of Qualcomm Robotics RB5 can be found after inet as something like 192.168.0.xxx.</p>
<p>Then you can access the camera with the help of the OpenCV library. A python example is given below</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line"></span><br><span class="line">cap = cv2.VideoCapture(&quot;tcp://192.168.1.120:8900&quot;) #rb5 ip &amp; port (same from command)</span><br><span class="line">while(True):</span><br><span class="line">    ret, frame = cap.read()</span><br><span class="line">    cv2.imwrite(&quot;captured_image_opencv.jpg&quot;,frame)</span><br><span class="line">    # you can process image by using frame </span><br><span class="line">    break</span><br><span class="line">cap.release()</span><br></pre></td></tr></table></figure>

<p>Again, make sure you change the host ip to your Qualcomm Robotics RB5 IP.</p>
<h2 id="accessing-camera-using-ROS-or-ROS2-packages"><a href="#accessing-camera-using-ROS-or-ROS2-packages" class="headerlink" title="accessing camera using ROS or ROS2 packages"></a>accessing camera using ROS or ROS2 packages</h2><p>Another way is to use the ROS packages we provided both in ROS1 and ROS2.</p>
<p>ROS1: <a target="_blank" rel="noopener" href="https://github.com/AutonomousVehicleLaboratory/rb5_ros">https://github.com/AutonomousVehicleLaboratory/rb5_ros</a><br>ROS2: <a target="_blank" rel="noopener" href="https://github.com/AutonomousVehicleLaboratory/rb5_ros2">https://github.com/AutonomousVehicleLaboratory/rb5_ros2</a></p>
<p>We provided launch file for both ROS and ROS2 packages so that it is easy to config the camera node.</p>
<h3 id="Access-the-Camera-in-ROS1"><a href="#Access-the-Camera-in-ROS1" class="headerlink" title="Access the Camera in ROS1"></a>Access the Camera in ROS1</h3><p>For ROS1 package, first clone it to your workspace.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># If you don&#x27;t already have a works space, create one first.</span><br><span class="line">mkdir -p rosws/src</span><br><span class="line"></span><br><span class="line"># Go to the source folder</span><br><span class="line">cd rosws/src</span><br><span class="line"></span><br><span class="line"># Clone the repository</span><br><span class="line">git clone https://github.com/AutonomousVehicleLaboratory/rb5_ros</span><br></pre></td></tr></table></figure>

<p>Then, build your package.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Return to the root folder of the workspace.</span><br><span class="line">cd ..</span><br><span class="line"></span><br><span class="line"># Include the ros tools, this assumes you have ROS1 melodic installed</span><br><span class="line">source /opt/ros/melodic/setup.bash</span><br><span class="line"></span><br><span class="line"># Build only this package</span><br><span class="line">catkin_make --only-pkg-with-deps rb5_vision</span><br></pre></td></tr></table></figure>

<p>Then you can run the package. For example, you can run the RGB camera by</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># source the ros workspace</span><br><span class="line">source devel/setup.bash</span><br><span class="line"></span><br><span class="line"># start the program with a set of parameters in the launch file</span><br><span class="line">roslaunch rb5_vision rb_camera_main_ocv.launch</span><br></pre></td></tr></table></figure>

<p>This will publish images to the topic &#x2F;camera_0.</p>
<p>start a new terminal and check with the following command.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">source /opt/ros/melodic/setup.bash</span><br><span class="line"></span><br><span class="line">rostopic list # list all the topics</span><br><span class="line">rostopic hz /camera_0 # get the frequency of the topic</span><br></pre></td></tr></table></figure>

<p>Finally, you can stop the process by pressing Ctrl + C in the terminal where it is running. Notice that it will take a few seconds for it to stop.</p>
<p>Similarly, you can run the tracking camera by</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch rb5_vision rb_camera_side_ocv.launch</span><br></pre></td></tr></table></figure>

<p>And this will publish images to the topic &#x2F;camera_1.</p>
<h3 id="Access-the-camera-in-ROS2"><a href="#Access-the-camera-in-ROS2" class="headerlink" title="Access the camera in ROS2"></a>Access the camera in ROS2</h3><p>For ROS2 package, first clone it to your workspace.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># If you don&#x27;t already have a works space, create one first.</span><br><span class="line">mkdir -p ros2ws/src</span><br><span class="line"></span><br><span class="line"># Go to the source folder</span><br><span class="line">cd ros2ws/src</span><br><span class="line"></span><br><span class="line"># Clone the repository</span><br><span class="line">git clone https://github.com/AutonomousVehicleLaboratory/rb5_ros2</span><br></pre></td></tr></table></figure>

<p>Then, build your package.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Return to the root folder.</span><br><span class="line">cd ..</span><br><span class="line"></span><br><span class="line"># Include the ros tools, this assumes you have ROS2 dashing installed</span><br><span class="line">source /opt/ros/dashing/setup.bash</span><br><span class="line"></span><br><span class="line"># Build only this package</span><br><span class="line">colcon build --packages-select rb5_ros2_vision</span><br></pre></td></tr></table></figure>

<p>Then you can run the package.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Source the ROS2 workspace</span><br><span class="line">source install/setup.bash</span><br><span class="line"></span><br><span class="line"># Run the RGB camera</span><br><span class="line">ros2 launch rb5_ros2_vision rb_camera_main_ocv_launch.py</span><br><span class="line"></span><br><span class="line"># Or run the tracking camera</span><br><span class="line">ros2 launch rb5_ros2_vision rb_camera_side_ocv_launch.py</span><br></pre></td></tr></table></figure>

<p>Again, you can verify that the message is being published using the following command in another new terminal.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">source /opt/ros/dashing/setup.bash</span><br><span class="line">ros2 topic list # check if the topic is being pubilshed</span><br><span class="line">ros2 topic hz /camera_0 # check the frequency of the RGB image message</span><br></pre></td></tr></table></figure>

<p>Reference:<br>[1]: <a target="_blank" rel="noopener" href="https://developer.qualcomm.com/comment/18637#comment-18637">https://developer.qualcomm.com/comment/18637#comment-18637</a></p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/RB5_Robotics_Tutorials/2022/02/15/2%20Accessing%20Devices/accessing-camera-on-rb5/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/RB5_Robotics_Tutorials/2022/02/13/1%20Initial%20Set-up/bring-up-rb5/"
                            aria-label=": (1) Bring Up Qualcomm Robotics RB5"
                        >
                            (1) Bring Up Qualcomm Robotics RB5
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2022-02-13T17:12:21-08:00">
	
		    Feb 13, 2022
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/RB5_Robotics_Tutorials/categories/1-Initial-Set-up/">1 Initial Set-up</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>Qualcomm Robotics RB5 is a powerful edge computing device for robotics applications. Before we can use it to drive cool applications, we need to flash an operating system into it. In this tutorial, we will show you how to set up Ubuntu 18.04 on Qualcomm Robotics RB5, connect it to WiFi to enable SSH and config HDMI display. We enhanced the <a target="_blank" rel="noopener" href="https://developer.qualcomm.com/qualcomm-robotics-rb5-kit/quick-start-guide/qualcomm_robotics_rb5_development_kit_bring_up">official setup guide</a> with some additional tips. The setup steps requires a computer with Ubuntu operating system. </p>
<h2 id="Install-Ubuntu-18-04-on-Qualcomm-Robotics-RB5"><a href="#Install-Ubuntu-18-04-on-Qualcomm-Robotics-RB5" class="headerlink" title="Install Ubuntu 18.04 on Qualcomm Robotics RB5"></a>Install Ubuntu 18.04 on Qualcomm Robotics RB5</h2><p>a) Install adb and fastboot by using the following command in Linux Terminal: </p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install android-tools-adb android-tools-fastboot</span><br></pre></td></tr></table></figure>

<p>b) Download the Qualcomm Robotics SDK Manager from <a target="_blank" rel="noopener" href="https://www.thundercomm.com/product/qualcomm-robotics-rb5-development-kit/#sdk-manager">here</a>. You will need to create an account for this.</p>
<p>c) The download should be a Zip file that contains the SDK Manager installation package and a Readme file. Follow the instructions in the Readme file to install the prerequisites.</p>
<p>d) Install the SDK manager on the Linux workstation. Refer to the process given as step 2 in the following <a target="_blank" rel="noopener" href="https://developer.qualcomm.com/qualcomm-robotics-rb5-kit/quick-start-guide/qualcomm_robotics_rb5_development_kit_bring_up/download-and-install-the-SDK-manager">link</a></p>
<p>e) <strong>Before running the SDK manager, if you are using a Linux workstation, run the following command in the Terminal</strong>: </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop ModemManager</span><br></pre></td></tr></table></figure>

<p>f) Run the SDK manager. Follow step 3 in the following <a target="_blank" rel="noopener" href="https://developer.qualcomm.com/qualcomm-robotics-rb5-kit/quick-start-guide/qualcomm_robotics_rb5_development_kit_bring_up/download-and-install-the-SDK-manager">link</a></p>
<p>g) Follow step 4 from the same <a target="_blank" rel="noopener" href="https://developer.qualcomm.com/qualcomm-robotics-rb5-kit/quick-start-guide/qualcomm_robotics_rb5_development_kit_bring_up/download-and-install-the-SDK-manager">link</a> to download resources and generate system image. This could take slightly more than 30 minutes. </p>
<p>h) Choose LU or LE flash. The LU flash has been tried before and flash was a success. This <a target="_blank" rel="noopener" href="https://developer.qualcomm.com/comment/18517">forum answer</a> is a possible explanation for the difference between LU and LE flash.</p>
<p>i) Now, start the process of flashing the generated system images on the Qualcomm Robotics RB5 by following step 5 from the same <a target="_blank" rel="noopener" href="https://developer.qualcomm.com/qualcomm-robotics-rb5-kit/quick-start-guide/qualcomm_robotics_rb5_development_kit_bring_up/download-and-install-the-SDK-manager">link</a></p>
<p>j) Follow steps 1-3 from this <a target="_blank" rel="noopener" href="https://developer.qualcomm.com/qualcomm-robotics-rb5-kit/quick-start-guide/qualcomm_robotics_rb5_development_kit_bring_up/flash-images">link</a> to continue and complete the flashing process successfully.</p>
<p>k) If flashing is successful, adb should be working. To check this, keep your Qualcomm Robotics RB5 connected to your workstation and open your workstationâ€™s terminal and type: </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell</span><br></pre></td></tr></table></figure>
<p>and you should see a device ID shown as an attached device.</p>
<p>l) If not, please power cycle the development kit. Since the system images are flashed, there is no need to press the F_DL key to force the device to enter the Emergency Download Mode.</p>
<h2 id="Setup-WiFi-and-SSH"><a href="#Setup-WiFi-and-SSH" class="headerlink" title="Setup WiFi and SSH"></a>Setup WiFi and SSH</h2><p>Once the OS is flashed, the next step involves setting up WiFi and SSH connections.<br>To set up WiFi connectivity on Qualcomm Robotics RB5, follow steps 1-4 from this <a target="_blank" rel="noopener" href="https://developer.qualcomm.com/qualcomm-robotics-rb5-kit/quick-start-guide/qualcomm_robotics_rb5_development_kit_bring_up/set-up-network">link</a></p>
<p>To access Qualcomm Robotics RB5 terminal, both adb shell or SSH can be used. To set up SSH connection:</p>
<p>a) Type the following commands in a new terminal:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb shell  </span><br><span class="line">sh-4.4#ifconfig </span><br></pre></td></tr></table></figure>
<p>The â€˜ifconfigâ€™ command gives you the IP address of your connection.<br>  Then use the following command:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh-4.4#ssh root@ &lt;IP address&gt;</span><br></pre></td></tr></table></figure>
<p> This will ask you for a password, which is â€˜oelinux123â€™</p>
<p>This will successfully complete the SSH connection, through which you can remotely access the Qualcomm Robotics RB5 terminal.</p>
<h2 id="HDMI-Display"><a href="#HDMI-Display" class="headerlink" title="HDMI Display"></a>HDMI Display</h2><p>The next step involves connecting to an HDMI monitor. The following is the procedure:</p>
<p>  a) Refer to the â€˜Check HDMIâ€™ section in this <a target="_blank" rel="noopener" href="https://developer.qualcomm.com/qualcomm-robotics-rb5-kit/quick-start-guide/qualcomm_robotics_rb5_development_kit_bring_up/set-up-network">link</a></p>
<p>  b) <strong>Instead of the 5 commands given in the link given in a), you could try just this single command after connecting the HDMI</strong>:<br>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">weston --connector=29</span><br></pre></td></tr></table></figure><br>  c) If b) doesnâ€™t work, then use the following 5 commands everytime while connecting HDMI:<br>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">c:\&gt;adb shell</span><br><span class="line">sh-4.4# mkdir -p /usr/bin/weston_socket</span><br><span class="line">sh-4.4# export XDG_RUNTIME_DIR=/usr/bin/weston_socket</span><br><span class="line">sh-4.4# export LD_LIBRARY_PATH=/usr/lib:/usr/lib/aarch64-linux-gnu/</span><br><span class="line">sh-4.4# weston --tty=1 --connector=29 --idle-time=0</span><br></pre></td></tr></table></figure></p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/RB5_Robotics_Tutorials/2022/02/13/1%20Initial%20Set-up/bring-up-rb5/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/RB5_Robotics_Tutorials/2022/02/13/3%20Robotics%20Applications/april-tag-feature-detection/"
                            aria-label=": (2) April Tag Feature Detection"
                        >
                            (2) April Tag Feature Detection
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2022-02-13T17:12:21-08:00">
	
		    Feb 13, 2022
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/RB5_Robotics_Tutorials/categories/3-Robotics-Applications/">3 Robotics Applications</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>An important task in robotics is to uniquely identify features and landmarks over time as a robot navigates through the environment. The process can help estimate the robotics position (localization) to ultimately be able to perform robust path planning and navigation. In this tutorial, we will explore a popular open-source library for AprilTag detection and 3D pose estimation from a single monorcular camera. </p>
<p>AprilTags (shown in the figure below) are a form of fiducial markers that are designed with predefined sizes and patterns. The benefit of knowing their size is pose estimation given that a perspective mapping between two planes can be described by a Homography $\mathbf{H}$ matrix. In this case, $\mathbf{H}$ can describe a mapping between the camera frame and the marker since both can be assumed to be flat surfaces. This makes AprilTags an easy way of performing 3D pose estimation of objects with a single monocular camera by simply placing an AprilTag on the object. In addition, the unique pattern that defines each marker can help differentiate multiple markers that may be observable at a particular instance and by leveraging the concept of Hamming distance and dictionaries, error detection and correction can be performed in the event that part of a marker is occluded.</p>
<div class="figure " style="width:;"><img class="fig-img" src="apriltags.png" alt="Multiple AprilTag fiducial markers detected within an image with IDs 7 and 237. For marker 7, an error is detected and corrected. [1]"><span class="caption">Multiple AprilTag fiducial markers detected within an image with IDs 7 and 237. For marker 7, an error is detected and corrected. [1]</span></div>
<h2 id="The-AprilTag3-Library"><a href="#The-AprilTag3-Library" class="headerlink" title="The AprilTag3 Library"></a>The AprilTag3 Library</h2><p>Using the AprilTag library is actually quite simple and can be installed from <a target="_blank" rel="noopener" href="https://github.com/AprilRobotics/apriltag">source</a>. This includes compatible versions for C++ but also Python3. While our implementation will consist of C++, the Python version is even easier to get up and running. To install, simply run <code>pip install apriltag</code>.</p>
<p>For convenience, we have provided two implementations for AprilTag detection in ROS1 and ROS2. Given that both are C++ implementations, the logic remains the same. First, we convert our image to grayscale and populate a <code>image_u8_t</code> struct using the OpenCV <code>cv::Mat</code> image format. </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cv::Mat image_gray; </span><br><span class="line">cv::<span class="built_in">cvtColor</span>(image, image_gray, cv::COLOR_BGR2GRAY);</span><br><span class="line"></span><br><span class="line"><span class="type">image_u8_t</span> im = &#123; .width  = image_gray.cols,</span><br><span class="line">.height = image_gray.rows,</span><br><span class="line">.stride = image_gray.cols, </span><br><span class="line">.buf    = image_gray.data </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p> Once the image has been converted to grayscale, we can instantiate an <code>apriltag_detection_t</code> instance and call <code>apriltag_detector_detect()</code>. This is the primary function incharge of performing marker detection on camera data. It is worth noting that this detection object can be reused so memory can be allocated in the class constructor of your implementation.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">apriltag_detector_t</span> *a_detector = <span class="built_in">apriltag_detector_create</span>();</span><br><span class="line"><span class="type">zarray_t</span> * detections = <span class="built_in">apriltag_detector_detect</span>(a_detector, &amp;im);</span><br></pre></td></tr></table></figure>

<p>As it can be seen, <code>apriltag_detector_detect()</code> returns an array of type <code>zarray_t</code> with the list of detections concatenated. In the following code block we extract individual detections into instances of type <code>apriltag_detection_t</code> and perform a perspective mapping using the homography matrix calculated. This is handled by <code>estimate_tag_pose()</code>. However, two important considerations include <em>i)</em> that we know the size of the markers in advance, and <em>ii)</em> we understand the intrinsic parameters of the camera that include image center and focal length. These are attributes that are part of the first argument of type <code>apriltag_detection_info_t</code> that is passed to <code>estimate_tag_pose()</code>. The marker size used in our implementation corresponds to $15.9cm$ and the camera parameters are estimated for the wide angle lens of the Qualcomm Robotics RB5 using the <a target="_blank" rel="noopener" href="https://docs.opencv.org/4.x/dc/dbb/tutorial_py_calibration.html">OpenCV calibration tool</a> and a standard checkerboard target.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">apriltag_detection_t</span> *det;</span><br><span class="line"><span class="type">apriltag_detection_info_t</span> tag_info; </span><br><span class="line">vector&lt;<span class="type">apriltag_pose_t</span>&gt; poses;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; ids;</span><br><span class="line"></span><br><span class="line">tag_info.tagsize = <span class="number">0.159</span>;</span><br><span class="line">tag_info.fx = <span class="number">663.57507</span>; </span><br><span class="line">tag_info.fy = <span class="number">694.47272</span>;</span><br><span class="line">tag_info.cx = <span class="number">956.22994</span>;</span><br><span class="line">tag_info.cy = <span class="number">539.54574</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="built_in">zarray_size</span>(detections); i++)&#123;</span><br><span class="line">  <span class="built_in">zarray_get</span>(detections, i, &amp;det);</span><br><span class="line">  tag_info.det = det;</span><br><span class="line">  <span class="type">apriltag_pose_t</span> pose;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// estimate SE(3) pose </span></span><br><span class="line">  <span class="built_in">estimate_tag_pose</span>(&amp;tag_info, &amp;pose);</span><br><span class="line">  poses.<span class="built_in">push_back</span>(pose);</span><br><span class="line">  ids.<span class="built_in">push_back</span>(det-&gt;id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The components described above have been wrapped into ROS1 and ROS2 implementations and be evaluated using the steps below.</p>
<h2 id="ROS1"><a href="#ROS1" class="headerlink" title="ROS1"></a>ROS1</h2><p>Create a workspace, clone the ROS1 implementation, and build the package. Make sure ROS is in your path, i.e. <code>source /opt/ros/melodic/setup.bash</code>. </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># install dependency</span><br><span class="line">apt install ros-melodic-apriltag</span><br><span class="line"></span><br><span class="line">mkdir -p rb5_ws/src &amp;&amp; cd rb5_ws/src</span><br><span class="line">git clone https://github.com/AutonomousVehicleLaboratory/rb5_ros.git</span><br><span class="line">cd ..</span><br><span class="line"></span><br><span class="line"># build all packages in the workspace</span><br><span class="line">catkin_make</span><br><span class="line">source devel/setup.bash</span><br><span class="line"></span><br><span class="line"># if the build all packages failed, try build only</span><br><span class="line">catkin_make --only-pkg-with-deps rb5_vision</span><br><span class="line">catkin_make --only-pkg-with-deps april_detection</span><br></pre></td></tr></table></figure>

<p>Start the camera node</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch rb5_vision rb_camera_main_ocv.launch</span><br></pre></td></tr></table></figure>

<p>Start the AprilTag detection node</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun april_detection april_detection_node</span><br></pre></td></tr></table></figure>



<h2 id="ROS2"><a href="#ROS2" class="headerlink" title="ROS2"></a>ROS2</h2><p>Create a workspace, clone the ROS2 implementation, and build the package. Make sure ROS is in your path, i.e. <code>source /opt/ros/dashing/setup.bash</code>. </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p rb5_ws/src &amp;&amp; cd rb5_ws/src</span><br><span class="line">git clone https://github.com/AutonomousVehicleLaboratory/rb5_ros2.git</span><br><span class="line">cd ..</span><br><span class="line">colcon build</span><br><span class="line">source rb5_ws/install/setup.bash </span><br></pre></td></tr></table></figure>

<p>Start the camera node</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 launch rb5_ros2_vision rb_camera_main_ocv_launch.py</span><br></pre></td></tr></table></figure>

<p>Start the AprilTag detection node</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 run ros2_april_detection april_detection_node</span><br></pre></td></tr></table></figure>



<h2 id="Visualizing-the-markers-and-poses"><a href="#Visualizing-the-markers-and-poses" class="headerlink" title="Visualizing the markers and poses"></a>Visualizing the markers and poses</h2><p>For convenience, our ROS implementations publish messages of type <code>geometry_msgs::PoseArray</code> (<a target="_blank" rel="noopener" href="http://docs.ros.org/en/melodic/api/geometry_msgs/html/msg/PoseArray.html">ROS1</a>) and <code>geometry_msgs::msg::PoseStamped</code> (<a target="_blank" rel="noopener" href="https://docs.ros2.org/foxy/api/geometry_msgs/msg/PoseStamped.html">ROS2</a>). These messages are timestamped and include a unique ID that corresponds to the marker ID as part of the message header. Nonetheless, the main component of each is message is the markerâ€™s pose in 3D which is represented as a position (a point) and orientation (here represented as a Quaternion). While we wonâ€™t go into the math component on how Quaternions are utilized to represent orientations in 3D space, ROS has an good tools for handling transformation and can handle transformations with ease. Below is a video of each marker being visualized using the 3D visualization tool for ROS called RViz. The video demos AprilTag3 detection and real-time 3D pose estimation running onboard of Qualcomm RB5.</p>
<div class="video-container"><iframe src="https://www.youtube.com/embed/qRoW6ljBfFo" frameborder="0" loading="lazy" allowfullscreen></iframe></div>


<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><p>[1] <a target="_blank" rel="noopener" href="https://april.eecs.umich.edu/media/pdfs/olson2011tags.pdf">AprilTag: A robust and flexible visual fiducial system</a></p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/RB5_Robotics_Tutorials/2022/02/13/3%20Robotics%20Applications/april-tag-feature-detection/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
        <li class="pagination-number">page 1 of 1</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2022 RB5 ROBOTICS TUTORIALS. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/RB5_Robotics_Tutorials/assets/images/avl-letters.png" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">RB5 ROBOTICS TUTORIALS</h4>
        
            <div id="about-card-bio"><p>A set of Robotics Tutorials developed for the RB5 Robotics Development Platform from Qualcomm. Authors are from the Contextual Robotics Institute at UC San Diego.</p>
</div>
        
        
            <div id="about-card-bio">
                <p>Contributors</p>

                <!-- <i class="fa fa-briefcase"></i>
                <br/> -->
                <p>Henrik I. Christensen, David Paz, Henry Zhang, Anirudh Ramesh.</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/RB5_Robotics_Tutorials/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/RB5_Robotics_Tutorials/assets/js/script-ouavugrvd9qj6lg3dktmularsze8hx0ahydxl4n9zvn5qystucng5rouil06.min.js"></script>

<!--SCRIPTS END-->





    </body>
</html>
